const translations = {
    ru: {
        hero_title: "Твой персональный Астролог",
        hero_subtitle: "Точные прогнозы, натальные карты, синастрия и цифровая психология Сюцай — всё в одном боте.",
        btn_start: "Запустить в Telegram",
        features_title: "Что умеет бот?",
        feat_natal_title: "Астро-Портрет",
        feat_natal_desc: "Глубокий анализ вашей личности: карьера, деньги, отношения и предназначение по натальной карте.",
        feat_daily_title: "Прогноз на день",
        feat_daily_desc: "Персональные транзиты планет и советы на каждый день.",
        feat_numerology_title: "Сюцай и Числа",
        feat_numerology_desc: "Цифровая психология. Узнай свое Число Сознания, Миссию и как прийти к успеху.",
        feat_solar_title: "Соляр (Прогноз на год)",
        feat_solar_desc: "Стратегия твоего личного года. Узнай главные тренды от дня рождения до дня рождения.",
        feat_compat_title: "Совместимость",
        feat_compat_desc: "Проверь партнера по звездам: любовь, бизнес, дружба и подводные камни.",
        feat_ask_title: "Вопрос Астрологу",
        feat_ask_desc: "Задай конкретный вопрос AI-астрологу и получи мгновенный ответ по своей карте.",
        footer_rights: "Все права защищены.",
        typing_phrases: ["Узнай свою судьбу", "Раскрой свой потенциал", "Найди идеального партнера", "Твой личный астролог 24/7"]
    },
    en: {
        hero_title: "Your Personal AI Astrologer",
        hero_subtitle: "Accurate forecasts, natal charts, synastry, and Syutsai digital psychology — all in one Telegram bot.",
        btn_start: "Start in Telegram",
        features_title: "Features",
        feat_natal_title: "Astro-Portrait",
        feat_natal_desc: "Deep analysis of your personality: career, money, relationships, and destiny via natal chart.",
        feat_daily_title: "Daily Forecast",
        feat_daily_desc: "Personal planetary transits and advice for every single day.",
        feat_numerology_title: "Syutsai & Numbers",
        feat_numerology_desc: "Digital psychology. Discover your Consciousness Number, Mission, and path to success.",
        feat_solar_title: "Solar Return (Yearly)",
        feat_solar_desc: "Your personal year strategy. Discover key trends from birthday to birthday.",
        feat_compat_title: "Compatibility",
        feat_compat_desc: "Check partner compatibility by stars: love, business, friendship, and pitfalls.",
        feat_ask_title: "Ask Astrologer",
        feat_ask_desc: "Ask a specific question to the AI astrologer and get an instant answer based on your chart.",
        footer_rights: "All rights reserved.",
        typing_phrases: ["Discover your destiny", "Unlock your potential", "Find your perfect match", "Your personal astrologer 24/7"]
    },
    de: {
        hero_title: "Ihr persönlicher AI-Astrologe",
        hero_subtitle: "Präzise Prognosen, Geburtshoroskope, Synastrie und digitale Psychologie Syutsai – alles in einem Bot.",
        btn_start: "In Telegram starten",
        features_title: "Funktionen",
        feat_natal_title: "Astro-Porträt",
        feat_natal_desc: "Tiefgehende Analyse Ihrer Persönlichkeit: Karriere, Geld, Beziehungen und Schicksal.",
        feat_daily_title: "Tagesprognose",
        feat_daily_desc: "Persönliche Planetentransite und Ratschläge für jeden Tag.",
        feat_numerology_title: "Syutsai & Zahlen",
        feat_numerology_desc: "Digitale Psychologie. Entdecken Sie Ihre Bewusstseinszahl und Mission.",
        feat_solar_title: "Solar (Jahresprognose)",
        feat_solar_desc: "Ihre persönliche Jahresstrategie. Entdecken Sie die wichtigsten Trends.",
        feat_compat_title: "Kompatibilität",
        feat_compat_desc: "Überprüfen Sie die Partnerkompatibilität: Liebe, Geschäft, Freundschaft.",
        feat_ask_title: "Frage an Astrologen",
        feat_ask_desc: "Stellen Sie dem AI-Astrologen eine Frage und erhalten Sie eine Antwort basierend auf Ihrem Horoskop.",
        footer_rights: "Alle Rechte vorbehalten.",
        typing_phrases: ["Entdecke dein Schicksal", "Entfalte dein Potenzial", "Finde den perfekten Partner", "Dein persönlicher Astrologe 24/7"]
    },
    es: {
        hero_title: "Tu Astrólogo Personal con IA",
        hero_subtitle: "Pronósticos precisos, cartas natales, sinastría y psicología digital Syutsai: todo en un bot.",
        btn_start: "Iniciar en Telegram",
        features_title: "Funciones",
        feat_natal_title: "Astro-Retrato",
        feat_natal_desc: "Análisis profundo de tu personalidad: carrera, dinero, relaciones y destino.",
        feat_daily_title: "Pronóstico Diario",
        feat_daily_desc: "Tránsitos planetarios personales y consejos para cada día.",
        feat_numerology_title: "Syutsai y Números",
        feat_numerology_desc: "Psicología digital. Descubre tu Número de Conciencia y Misión.",
        feat_solar_title: "Retorno Solar (Anual)",
        feat_solar_desc: "Tu estrategia personal anual. Descubre las tendencias clave.",
        feat_compat_title: "Compatibilidad",
        feat_compat_desc: "Comprueba la compatibilidad con tu pareja: amor, negocios, amistad.",
        feat_ask_title: "Preguntar al Astrólogo",
        feat_ask_desc: "Haz una pregunta específica y obtén una respuesta instantánea basada en tu carta.",
        footer_rights: "Todos los derechos reservados.",
        typing_phrases: ["Descubre tu destino", "Libera tu potencial", "Encuentra tu pareja ideal", "Tu astrólogo personal 24/7"]
    },
    fr: {
        hero_title: "Votre Astrologue Personnel IA",
        hero_subtitle: "Prévisions précises, thèmes astraux, synastrie et psychologie numérique Syutsai — tout en un bot.",
        btn_start: "Lancer sur Telegram",
        features_title: "Fonctionnalités",
        feat_natal_title: "Astro-Portrait",
        feat_natal_desc: "Analyse approfondie de votre personnalité : carrière, argent, relations et destin.",
        feat_daily_title: "Prévisions Quotidiennes",
        feat_daily_desc: "Transits planétaires personnels et conseils pour chaque jour.",
        feat_numerology_title: "Syutsai & Chiffres",
        feat_numerology_desc: "Psychologie numérique. Découvrez votre Numéro de Conscience et Mission.",
        feat_solar_title: "Révolution Solaire",
        feat_solar_desc: "Votre stratégie annuelle personnelle. Découvrez les tendances clés.",
        feat_compat_title: "Compatibilité",
        feat_compat_desc: "Vérifiez la compatibilité avec votre partenaire : amour, affaires, amitié.",
        feat_ask_title: "Question à l'Astrologue",
        feat_ask_desc: "Posez une question spécifique et obtenez une réponse instantanée basée sur votre thème.",
        footer_rights: "Tous droits réservés.",
        typing_phrases: ["Découvrez votre destin", "Libérez votre potentiel", "Trouvez le partenaire idéal", "Votre astrologue personnel 24/7"]
    }
};

// Typing Effect Variables
let typeIndex = 0;
let phraseIndex = 0;
let currentLang = 'ru';
let isDeleting = false;
const typingElement = document.querySelector('.typing-text');

function typeEffect() {
    const phrases = translations[currentLang].typing_phrases;
    const currentPhrase = phrases[phraseIndex];
    
    if (isDeleting) {
        typingElement.textContent = currentPhrase.substring(0, typeIndex - 1);
        typeIndex--;
    } else {
        typingElement.textContent = currentPhrase.substring(0, typeIndex + 1);
        typeIndex++;
    }

    let typeSpeed = isDeleting ? 50 : 100;

    if (!isDeleting && typeIndex === currentPhrase.length) {
        typeSpeed = 2000; // Pause at end
        isDeleting = true;
    } else if (isDeleting && typeIndex === 0) {
        isDeleting = false;
        phraseIndex = (phraseIndex + 1) % phrases.length;
        typeSpeed = 500;
    }

    setTimeout(typeEffect, typeSpeed);
}

// Language Switcher Logic
document.addEventListener('DOMContentLoaded', () => {
    const selector = document.getElementById('language-selector');
    
    // 1. Detect Lang
    let savedLang = localStorage.getItem('lang') || navigator.language.slice(0, 2);
    if (!translations[savedLang]) savedLang = 'en'; 
    currentLang = savedLang;

    // 2. Set Initial
    selector.value = currentLang;
    applyLanguage(currentLang);
    
    // Start typing effect
    typeEffect();

    // 3. Change Event
    selector.addEventListener('change', (e) => {
        const newLang = e.target.value;
        localStorage.setItem('lang', newLang);
        currentLang = newLang;
        applyLanguage(newLang);
        // Reset typing for new language immediately
        isDeleting = true; 
        typeIndex = 0;
    });
});

function applyLanguage(lang) {
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            el.textContent = translations[lang][key];
        }
    });
}
